Описание системы резервного копирования


1. Введение  
Настоящий документ описывает архитектуру и процессы системы резервного копирования, обеспечивающей надежное хранение и восстановление данных. Система включает в себя локальное и облачное резервное копирование, а также создание снимков (снапшотов) данных для обеспечения отказоустойчивости и минимизации потерь в случае сбоев.


2. Архитектура системы  
Система резервного копирования состоит из следующих компонентов:  
- Бэкап-сервер: Расположен в отдельной зоне доступности, на нем установлен инструмент restic, который выполняет резервное копирование данных с трех машин.  
- Облачное хранилище (Cloud Backup): Интегрировано с бэкап-сервером для долгосрочного хранения данных.  
- Три сервера: На каждом из них настроены SSH-соединения с бэкап-сервером, где запускается скрипт backup.sh для передачи данных на бэкап-сервер.  
- Облачная платформа: Используется для создания снапшотов по расписанию.  


3. Процесс резервного копирования  

3.1. Локальное резервное копирование  
- На бэкап-сервере установлен инструмент restic, который обеспечивает полное и инкрементальное резервное копирование данных, поступающих с трех машин.  
- Запускается скрипт backup.sh, который выполняет следующие действия:  
  - Устанавливает SSH-соединение с бэкап-сервером.  
  - Передает данные на бэкап-сервер для дальнейшего резервного копирования.  
- На бэкап-сервере restic создает полную резервную копию при первом запуске и выполняет инкрементальное копирование при последующих запусках, сохраняя только изменения.  
- Проверяется целостность данных после завершения копирования.  

3.2. Облачное резервное копирование  
- Бэкап-сервер подключен к облачному хранилищу (Cloud Backup).  
- Данные с бэкап-сервера синхронизируются с облачным хранилищем для обеспечения дополнительной надежности.  

3.3. Создание снапшотов  (Создать снимок диска - https://yandex.cloud/ru/docs/compute/operations/disk-control/create-snapshot#cli_1)
- Облачная платформа настроена на создание снапшотов по расписанию (еженедельно).  
- Снапшоты позволяют быстро восстанавливать данные в случае сбоев или повреждений.  


4. Настройка и инструменты  

4.1. Инструменты  
- Restic: Установлен на бэкап-сервере, используется для создания резервных копий. Поддерживает шифрование, сжатие и инкрементальное копирование.  
- SSH: Обеспечивает безопасное соединение между машинами и бэкап-сервером.  
- Скрипт backup.sh: Передает данные на бэкап-сервер.  

4.2. Настройка  
- На каждой из трех машин:  
  - Настроены SSH-ключи для доступа к бэкап-серверу.  
  - Скрипт backup.sh добавлен в cron для выполнения по расписанию.  
- На бэкап-сервере:  
  - Установлен restic.  
  - Настроено подключение к облачному хранилищу.  
  - Регулярно проверяется доступность и целостность данных.  


5. Восстановление данных  
- Для восстановления данных используется инструмент restic на бэкап-сервере.  
- В случае потери данных на одной из машин:  
  - Выполняется восстановление из последней резервной копии.  
  - При необходимости используются снапшоты из облачной платформы.

- Проверка целостности репозитория:
 
  restic -r /backup/repo check
  
- Список бэкапов:
 
  restic -r /backup/repo snapshots
  
- Восстановление данных:
 
  restic -r /backup/repo restore latest --target /path/to/restore
  

6. Мониторинг и отчетность  
- На всех этапах резервного копирования ведется логирование.  
- Регулярно проверяется целостность данных и успешность выполнения задач.  
- В случае ошибок администраторы уведомляются через систему мониторинга. (через node_exporter)  


7. Заключение  
Описанная система обеспечивает надежное резервное копирование данных с использованием локальных и облачных ресурсов. Инкрементальное копирование и снапшоты минимизируют нагрузку на ресурсы и обеспечивают быстрое восстановление в случае сбоев.  

